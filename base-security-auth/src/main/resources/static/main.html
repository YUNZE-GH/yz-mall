<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body onload="init()">
<div>登录成功！！！</div>
<div>
    授权码：<span id="code"></span>
</div>
<div>
    access_token: <span id="access_token"></span>
</div>
<div>
    refresh_token: <span id="refresh_token"></span>
</div>


</body>
<script src="./js/jquery-3.6.1.min.js" type="text/javascript"></script>
<script>
    function init() {
        const url = window.location.href;
        console.log(url)
        let data = url.split("?")[1];
        if (data) {
            data = new URLSearchParams(data);
            const params = Object.fromEntries(data.entries());
            document.getElementById("code").innerText = params.code;
            getToken(params.code);
            console.log(params)
            return params
        } else {
            return null;
        }
    }

    function getToken(code){
        $.ajax({
            type: "POST",
            url: "http://localhost:20002/oauth/token",
            data: {
                "grant_type": "authorization_code",
                "client_id": "3xj",
                "client_secret": "3xj",
                "redirect_uri": "http://localhost:20002/main.html",
                "code": code
            },
            dataType: "json",
            success: function (data) {
                document.getElementById("access_token").innerText=data.access_token;
                document.getElementById("refresh_token").innerText=data.refresh_token;
            }
        })
    }
</script>
</html>